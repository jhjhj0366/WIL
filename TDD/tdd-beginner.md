## TDD 를 진행하기 전, 생각 해봐야할 내용

단위 테스트와 TDD를 시작할 때 어디서 어떻게 시작해야할지 모를 때가 많다.

### **도메인 지식을 기반으로 객체 설계 경험이 있는 경우**

도메인 지식을 기반으로 객체 설계 경험이 있는 경우에는 요구사항 분석을 통해 객체를 추출하면 된다. 여기에서 주의할 점은 객체를 추출할 때, **UI(화면), DB(데이터) 등과 의존관계를 가지지 않는 핵심 도메인 영역을 집중 설계해야 한다.**

### **도메인 지식이 없고 객체 설계 경험이 없는 경우**

도메인 지식 기반으로 한 객체 설계 경험이 없는 경우 도메인 설계만으로도 어렵다. 경험 없이 구현을 먼저 진행한다면 흐름 지향적인 코드(절차 지향적인 객체)가 만들어지게 된다. 도메인 지식이 없고 객체 설계 경험이 없는 경우는 해결하고 싶은 문제가 무엇인지 백지에 그려봐야 한다.

**설계에서 연습**

1. TDD를 진행하기 전, **목표로하는 서비스를 시도할 수 있는지 판단한다**. 
→ 목표로 하는 서비스의 todo 리스트를 작성할 수 있는지 확인한다.
2. todo 리스트를 작성한다.

> 💡 객체 지향적인 설계를 추구하고 싶다면 먼저, **기능 목록을 작성해보고,** 기능 목록을 기반으로 각 객체들 간의 어떠한 협력관계로 게임이 진행하는지, 서로 어떠한 메시지를 주고 받는지 생각하며 그림으로 그려보길 추천한다.

**구현에서 연습**

1. 구현이 막막하다면 단위 테스트, 객체 지향적인 설계, 기능 목록을 분리하지 않고 익숙한 방식으로 구현한다.
2. 익숙한 방식으로 구현하면서 구현하려는 프로그래밍의 도메인 지식을 쌓는다.
3. 구현한 모든 코드를 버린다.
4. 구현할 기능 목록을 작성하거나 간단한 도메인을 설계한다.
5. 기능 목록 중 가장 간단한 기능부터 TDD를 이용해 구현한다.
6. 복잡도가 높아져 리팩토링하기 힘든 상태가 되면 다시 버린다.
7. 다시 도전한다.

> 💡 TDD로 진행하기 어렵고, 리팩토링이 진행이 안되고, 자신이 짠 코드가 너무 복잡하다 생각이 들면 코드를 전부 지우고 설계에서부터 다시 시작한다.

**테스트**

- **테스트하기 어려운 부분을 찾아 가능한 구조로 개선한다.**
- **Object Graph에서 다른 Object와 의존관계를 가지지 않는 마지막 노드를 먼저 찾는다.**

**대표적으로 테스트하기 어려운 코드**

내부 동작이 일정하지 않거나, 외부 환경에 영향을 받는 요인들은 테스트하기 어렵다.

- 내부 API
    - Random, shuffle, 날짜
- 외부 API
    - 외부 REST API
    - 데이터베이스 API

**테스트하기 어려운 구조**

마지막 노드가 난수 생성이 되면 전체적인 테스트 진행이 되지 않는다. 그렇기 때문에 Main 까지 의존관계를 올리면 RacingGame과 Car를 테스트할 수 있게 된다.


**테스트할 때 Stub과 Mock 중 어느 것을 사용해야할까**

일반적으로 테스트 시간이 오래걸려서 Mock을 사용하지 않고 Stub을 사용할 때가 있다고 생각했는데 이러한 이유 말고도 각각의 방식을 고수해야할 때가 있다고 한다.

- Stub은 **입력값에 따른 결과값을 비교하기 위해서 사용한다.** 추가적으로 특정한 입력값에 대한 예외가 발생하는지 확인하기 위해 사용한다.
- Mock기반의 테스트는 행위 기반의 테스트로 작성이 된다. **그렇기 때문에 특정한 메서드가 정상적으로 호출되었는지 확인하기 위해 사용한다.**